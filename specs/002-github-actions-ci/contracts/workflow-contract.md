# GitHub Actions Workflow Contract

This contract defines the expected behavior and interface for the GitHub Actions CI/CD pipeline.

## Workflow Trigger Contract

```yaml
# Trigger Specification
on:
  push:
    branches: [ main ]
    paths-ignore:
      - '**.md'
      - 'docs/**'
```

**Contract Requirements:**
- MUST trigger only on push events to main branch
- MUST ignore documentation-only changes
- MUST NOT trigger on pull requests or other branches

## Job Dependencies Contract

```yaml
# Job Execution Order
jobs:
  build:
    # Runs immediately on trigger
  
  deploy:
    needs: build
    # Runs only after build succeeds
```

**Contract Requirements:**
- `build` job MUST complete successfully before `deploy` job starts
- `deploy` job MUST NOT run if `build` job fails
- Jobs MUST run sequentially, not in parallel

## Permissions Contract

```yaml
# Required Permissions
permissions:
  contents: read      # Read repository contents
  pages: write        # Deploy to GitHub Pages  
  id-token: write     # OIDC token for Pages deployment
```

**Contract Requirements:**
- MUST use minimal required permissions only
- MUST NOT request broader permissions than needed
- MUST include id-token for secure Pages deployment

## Environment Variables Contract

```yaml
# Environment Configuration
env:
  NODE_VERSION: '22'
  PNPM_VERSION: '10.15.0'
  CI: true
```

**Contract Requirements:**
- Node.js version MUST be 22 (LTS)
- pnpm version MUST match package.json packageManager
- CI flag MUST be set for optimal build behavior

## Artifact Contract

```yaml
# Build Artifacts
- name: Upload build artifacts
  uses: actions/upload-pages-artifact@v3
  with:
    path: ./out
```

**Contract Requirements:**
- Artifact MUST contain static files from `./out` directory
- Artifact MUST be generated by successful Next.js build
- Artifact MUST be uploaded before deployment job runs

## Deployment Output Contract

```yaml
# Deployment Results
outputs:
  page_url:
    description: "URL of the deployed GitHub Pages site"
    value: ${{ steps.deployment.outputs.page_url }}
```

**Contract Requirements:**
- MUST provide deployed site URL as output
- URL MUST be accessible immediately after deployment
- URL format MUST be: `https://{owner}.github.io/{repo-name}/`

## Status Reporting Contract

**Success Indicators:**
- All jobs complete with exit code 0
- GitHub Pages environment shows "Active" status
- Deployed site loads without errors
- Build artifacts contain expected files

**Failure Indicators:**
- Any job exits with non-zero code
- Test suite failures block deployment
- Build process errors prevent artifact creation
- Deployment fails due to permissions or conflicts

## Recovery Contract

**Automatic Recovery:**
- Failed deployments preserve previous working version
- Subsequent successful builds overwrite failed attempts
- No manual intervention required for transient failures

**Manual Recovery:**
- Repository admin can manually trigger workflow re-run
- Previous deployments remain accessible during failures
- Rollback available through GitHub Pages settings